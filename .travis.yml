language: python

# use the faster container-based architecture
sudo: false

# versions to test
matrix:
  include:
    - python: 3.3
      env:
        - NUMPYVERSION=
        - SCIPYVERSION=
        - MATPLOTLIBVERSION=
    - python: 3.3
      env:
        - NUMPYVERSION===1.8.0
        - SCIPYVERSION===0.13.0
        - MATPLOTLIBVERSION===1.2.0
    - python: 3.4
      env:
        - NUMPYVERSION=
        - SCIPYVERSION=
        - MATPLOTLIBVERSION=
    - python: 3.4
      env:
        - NUMPYVERSION===1.8.0
        - SCIPYVERSION===0.13.0
        - MATPLOTLIBVERSION===1.2.0

# install Miniconda; use it to install dependencies
install:
  - wget http://repo.continuum.io/miniconda/Miniconda3-3.8.3-Linux-x86_64.sh -O miniconda.sh
  - bash miniconda.sh -b -p $(pwd)/miniconda
  - export PATH="$(pwd)/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda info -a
  - DEPS="pip nose coverage numpy$NUMPYVERSION scipy$SCIPYVERSION matplotlib$MATPLOTLIBVERSION h5py"
  - conda create -q -n test-environment python=$TRAVIS_PYTHON_VERSION $DEPS
  - source activate test-environment
  - pip install coveralls

# run tests (select a proper matplotlib backend)
before_script:
  - "echo backend : Agg > matplotlibrc"
script:  nosetests --with-doctest --with-coverage --cover-erase --verbose --detailed-errors

# check coverage
after_success:
  - coveralls

# if tests fail, upload images to imgur
after_failure:
  - wget http://imgur.com/tools/imgurbash.sh
  - for img in result_images/test_plot/*.png; do echo -e "\n$img"; bash imgurbash.sh $img; done
